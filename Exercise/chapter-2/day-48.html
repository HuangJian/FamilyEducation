<html>

<head>
  <script src="https://cdn.tailwindcss.com/3.0.12"></script>
</head>

<body>
  <section id="output">
    <div id="math" class="flex flex-col max-w-2xl mx-auto">
      <div class="hidden">4+?=8,7+?=12,13+?=32
        ?-6=6,?-19=13,?-12=26
        44-?=26,32-?=10,60-?=25
        33+27=?,45+39=?,100-100=?
        4*7=?,4*8=?,4*9=?
        ---
        ?+18=29-2,?+33=11+22
        12+?+12=36,32+21+10+8=?
        15+?=33-?,18+13+25+17=?
        ?-17=?+20,33-22-9-2=?</div>
      <div class="flex origin-left mt-2">
        <div class="question flex-1"><span>4</span><span>+</span><span class="box"></span><span>=</span><span>8</span>
        </div>
        <div class="question flex-1"><span>7</span><span>+</span><span class="box"></span><span>=</span><span>12</span>
        </div>
        <div class="question flex-1"><span>13</span><span>+</span><span class="box"></span><span>=</span><span>32</span>
        </div>
      </div>
      <div class="flex origin-left mt-2">
        <div class="question flex-1"><span class="box"></span><span>-</span><span>6</span><span>=</span><span>6</span>
        </div>
        <div class="question flex-1"><span class="box"></span><span>-</span><span>19</span><span>=</span><span>13</span>
        </div>
        <div class="question flex-1"><span class="box"></span><span>-</span><span>12</span><span>=</span><span>26</span>
        </div>
      </div>
      <div class="flex origin-left mt-2">
        <div class="question flex-1"><span>44</span><span>-</span><span class="box"></span><span>=</span><span>26</span>
        </div>
        <div class="question flex-1"><span>32</span><span>-</span><span class="box"></span><span>=</span><span>10</span>
        </div>
        <div class="question flex-1"><span>60</span><span>-</span><span class="box"></span><span>=</span><span>25</span>
        </div>
      </div>
      <div class="flex origin-left mt-2">
        <div class="question flex-1"><span>33</span><span>+</span><span>27</span><span>=</span><span class="box"></span>
        </div>
        <div class="question flex-1"><span>45</span><span>+</span><span>39</span><span>=</span><span class="box"></span>
        </div>
        <div class="question flex-1"><span>100</span><span>-</span><span>100</span><span>=</span><span
            class="box"></span></div>
      </div>
      <div class="flex origin-left mt-2">
        <div class="question flex-1"><span>4</span><span>×</span><span>7</span><span>=</span><span class="box"></span>
        </div>
        <div class="question flex-1"><span>4</span><span>×</span><span>8</span><span>=</span><span class="box"></span>
        </div>
        <div class="question flex-1"><span>4</span><span>×</span><span>9</span><span>=</span><span class="box"></span>
        </div>
      </div>
      <hr class="mt-2">
      <div class="flex origin-left mt-2">
        <div class="question flex-1"><span
            class="box"></span><span>+</span><span>18</span><span>=</span><span>29</span><span>-</span><span>2</span>
        </div>
        <div class="question flex-1"><span
            class="box"></span><span>+</span><span>33</span><span>=</span><span>11</span><span>+</span><span>22</span>
        </div>
      </div>
      <div class="flex origin-left mt-2">
        <div class="question flex-1"><span>12</span><span>+</span><span
            class="box"></span><span>+</span><span>12</span><span>=</span><span>36</span></div>
        <div class="question flex-1">
          <span>32</span><span>+</span><span>21</span><span>+</span><span>10</span><span>+</span><span>8</span><span>=</span><span
            class="box"></span></div>
      </div>
      <div class="flex origin-left mt-2">
        <div class="question flex-1"><span>15</span><span>+</span><span
            class="box"></span><span>=</span><span>33</span><span>-</span><span class="box"></span></div>
        <div class="question flex-1">
          <span>18</span><span>+</span><span>13</span><span>+</span><span>25</span><span>+</span><span>17</span><span>=</span><span
            class="box"></span></div>
      </div>
      <div class="flex origin-left mt-2">
        <div class="question flex-1"><span class="box"></span><span>-</span><span>17</span><span>=</span><span
            class="box"></span><span>+</span><span>20</span></div>
        <div class="question flex-1">
          <span>33</span><span>-</span><span>22</span><span>-</span><span>9</span><span>-</span><span>2</span><span>=</span><span
            class="box"></span></div>
      </div>
    </div>
    <hr class="my-2">
    <div id="char" class="flex flex-col max-w-2xl mx-auto">
      <div class="hidden">开心果关门</div>
      <div class="flex scale-[0.7] origin-left sample"><svg>
          <use href="#char0"></use>
        </svg>
        <svg>
          <use href="#char0"></use>
        </svg>
        <svg>
          <use href="#char0"></use>
        </svg>
        <svg>
          <use href="#char0"></use>
        </svg>
      </div>
      <div class="write-them-down flex w-100 justify-between"><svg>
          <g transform="translate(5, 43.671875) scale(0.04296875, -0.04296875)" id="char0">
            <path
              d="M 612 685 Q 634 691 660 694 Q 717 706 726 713 Q 736 722 731 731 Q 724 744 693 753 Q 663 760 557 728 Q 431 700 324 691 Q 284 687 312 667 Q 355 640 417 652 Q 487 665 561 677 L 612 685 Z">
            </path>
            <path
              d="M 653 401 Q 752 411 907 399 Q 932 396 938 405 Q 945 418 933 431 Q 902 459 857 480 Q 842 487 815 478 Q 742 462 667 451 Q 660 451 653 449 L 594 442 Q 453 429 407 421 L 350 414 Q 310 413 282 407 Q 209 395 101 394 Q 86 394 85 382 Q 85 369 104 354 Q 149 321 187 334 Q 229 350 342 365 Q 343 366 347 366 L 403 375 Q 460 387 594 395 L 653 401 Z">
            </path>
            <path
              d="M 407 421 Q 411 464 413 514 Q 417 535 419 546 Q 425 568 403 578 Q 354 603 337 601 Q 316 597 333 574 Q 354 535 350 414 L 347 366 Q 347 245 264 128 Q 216 77 200 61 Q 185 48 182 41 Q 179 34 192 34 Q 208 34 230 49 Q 273 77 300 106 Q 373 187 394 314 Q 398 342 403 375 L 407 421 Z">
            </path>
            <path
              d="M 599 -2 Q 605 -30 613 -41 Q 619 -48 627 -46 Q 645 -37 651 31 Q 658 115 656 197 Q 653 248 653 401 L 653 449 Q 653 554 665 632 Q 669 651 653 663 Q 628 679 612 685 C 585 698 551 705 561 677 Q 558 670 577 643 Q 587 622 593 530 Q 593 490 594 442 L 594 395 Q 588 68 599 -2 Z">
            </path>
          </g>
        </svg><svg>
          <use href="#char0"></use>
        </svg><svg>
          <use href="#char0"></use>
        </svg><svg>
          <use href="#char0"></use>
        </svg><svg>
          <use href="#char0"></use>
        </svg><svg>
          <use href="#char0"></use>
        </svg><svg></svg><svg></svg><svg></svg><svg></svg><svg></svg></div>
      <div class="flex scale-[0.7] origin-left sample"><svg>
          <use href="#char1"></use>
        </svg>
        <svg>
          <use href="#char1"></use>
        </svg>
        <svg>
          <use href="#char1"></use>
        </svg>
        <svg>
          <use href="#char1"></use>
        </svg>
      </div>
      <div class="write-them-down flex w-100 justify-between"><svg>
          <g transform="translate(5, 43.671875) scale(0.04296875, -0.04296875)" id="char1">
            <path
              d="M 171 459 Q 147 381 112 311 Q 91 269 117 230 Q 129 209 152 227 Q 177 249 190 289 Q 211 344 208 392 Q 211 432 199 462 Q 192 472 185 472 Q 175 469 171 459 Z">
            </path>
            <path
              d="M 863 228 Q 859 243 834 262 Q 797 290 698 391 Q 691 398 685 398 Q 682 397 684 389 Q 708 338 732 281 Q 742 257 728 241 Q 689 208 550 226 Q 441 244 397 323 Q 370 377 355 435 Q 348 463 324 476 Q 306 486 299 478 Q 295 474 302 454 Q 312 429 335 363 Q 372 224 476 178 Q 495 171 521 163 Q 710 115 851 212 Q 866 221 863 228 Z">
            </path>
            <path
              d="M 441 617 Q 475 578 511 531 Q 524 515 541 513 Q 553 512 561 525 Q 568 541 564 574 Q 560 619 444 670 Q 428 677 420 675 Q 414 672 414 658 Q 415 645 441 617 Z">
            </path>
            <path
              d="M 760 585 Q 814 536 877 465 Q 896 441 914 437 Q 924 436 933 447 Q 948 463 932 514 Q 922 563 840 592 Q 789 613 761 621 Q 751 627 748 612 Q 747 596 760 585 Z">
            </path>
          </g>
        </svg><svg>
          <use href="#char1"></use>
        </svg><svg>
          <use href="#char1"></use>
        </svg><svg>
          <use href="#char1"></use>
        </svg><svg>
          <use href="#char1"></use>
        </svg><svg>
          <use href="#char1"></use>
        </svg><svg></svg><svg></svg><svg></svg><svg></svg><svg></svg></div>
      <div class="flex scale-[0.7] origin-left sample"><svg>
          <use href="#char2"></use>
        </svg>
        <svg>
          <use href="#char2"></use>
        </svg>
        <svg>
          <use href="#char2"></use>
        </svg>
        <svg>
          <use href="#char2"></use>
        </svg>
        <svg>
          <use href="#char2"></use>
        </svg>
        <svg>
          <use href="#char2"></use>
        </svg>
        <svg>
          <use href="#char2"></use>
        </svg>
        <svg>
          <use href="#char2"></use>
        </svg>
      </div>
      <div class="write-them-down flex w-100 justify-between"><svg>
          <g transform="translate(5, 43.671875) scale(0.04296875, -0.04296875)" id="char2">
            <path
              d="M 275 763 Q 271 764 266 764 Q 253 768 249 762 Q 242 755 252 737 Q 289 664 312 541 Q 316 504 338 480 Q 357 456 363 474 Q 366 484 367 496 L 366 521 Q 365 537 361 555 Q 334 684 329 722 C 325 752 305 759 275 763 Z">
            </path>
            <path
              d="M 597 528 Q 618 494 636 485 Q 648 476 664 499 Q 680 524 716 668 Q 726 702 753 729 Q 768 742 755 757 Q 739 776 693 806 Q 674 815 599 800 Q 572 799 419 775 Q 314 760 275 763 C 245 764 300 714 329 722 Q 381 737 459 746 L 498 751 Q 633 772 650 754 Q 663 738 660 721 Q 630 565 610 551 C 596 529 596 529 597 528 Z">
            </path>
            <path
              d="M 517 631 Q 550 637 579 641 Q 601 645 593 657 Q 583 670 559 675 Q 543 678 517 671 L 468 658 Q 416 645 371 632 Q 355 628 374 615 Q 384 608 405 611 Q 438 618 469 622 L 517 631 Z">
            </path>
            <path
              d="M 517 517 Q 559 524 597 528 C 627 531 636 537 610 551 Q 577 572 517 549 L 469 540 Q 414 530 366 521 C 337 515 337 495 367 496 Q 374 496 384 497 Q 429 504 470 510 L 517 517 Z">
            </path>
            <path
              d="M 524 382 Q 581 388 825 388 Q 846 388 850 396 Q 856 408 840 422 Q 786 461 750 454 Q 660 438 517 417 L 469 411 Q 322 395 157 378 Q 136 377 151 359 Q 164 346 183 339 Q 204 333 220 338 Q 314 362 422 372 L 524 382 Z">
            </path>
            <path
              d="M 517 417 Q 517 466 517 517 L 517 549 Q 518 583 518 616 Q 517 623 517 631 L 517 671 Q 517 714 520 722 Q 523 734 514 741 Q 508 745 498 751 C 474 769 451 775 459 746 Q 466 733 467 709 Q 467 684 468 658 L 469 622 Q 469 582 469 540 L 470 510 Q 470 461 469 411 L 468 341 Q 468 164 457 42 Q 454 0 479 -33 Q 492 -48 501 -30 Q 528 22 521 67 Q 518 113 517 345 L 517 417 Z">
            </path>
            <path
              d="M 422 372 Q 416 353 398 327 Q 344 249 283 196 Q 232 150 127 80 Q 108 67 125 66 Q 137 63 178 80 Q 236 99 288 138 Q 399 225 454 319 Q 461 332 468 341 C 496 382 446 433 422 372 Z">
            </path>
            <path
              d="M 517 345 Q 704 104 751 86 Q 823 68 938 82 Q 959 83 961 88 Q 964 95 947 103 Q 755 191 732 206 Q 648 260 527 380 Q 524 381 524 382 C 502 402 486 385 517 345 Z">
            </path>
          </g>
        </svg><svg>
          <use href="#char2"></use>
        </svg><svg>
          <use href="#char2"></use>
        </svg><svg>
          <use href="#char2"></use>
        </svg><svg>
          <use href="#char2"></use>
        </svg><svg>
          <use href="#char2"></use>
        </svg><svg></svg><svg></svg><svg></svg><svg></svg><svg></svg></div>
      <div class="flex scale-[0.7] origin-left sample"><svg>
          <use href="#char3"></use>
        </svg>
        <svg>
          <use href="#char3"></use>
        </svg>
        <svg>
          <use href="#char3"></use>
        </svg>
        <svg>
          <use href="#char3"></use>
        </svg>
        <svg>
          <use href="#char3"></use>
        </svg>
        <svg>
          <use href="#char3"></use>
        </svg>
      </div>
      <div class="write-them-down flex w-100 justify-between"><svg>
          <g transform="translate(5, 43.671875) scale(0.04296875, -0.04296875)" id="char3">
            <path
              d="M 359 703 Q 383 681 409 652 Q 422 639 440 639 Q 450 639 457 653 Q 461 668 454 700 Q 445 730 355 754 Q 339 758 332 755 Q 326 751 328 738 Q 331 726 359 703 Z">
            </path>
            <path
              d="M 641 764 Q 620 733 543 647 Q 533 629 550 633 Q 599 660 684 716 Q 703 732 730 742 Q 752 752 742 771 Q 729 790 701 806 Q 676 821 663 818 Q 650 817 654 803 Q 657 784 641 764 Z">
            </path>
            <path
              d="M 500 524 Q 582 537 670 550 Q 731 562 741 570 Q 751 577 747 587 Q 740 600 709 610 Q 673 619 586 591 Q 445 558 313 551 Q 273 547 300 527 Q 342 502 419 513 Q 434 516 451 516 L 500 524 Z">
            </path>
            <path
              d="M 531 330 Q 585 336 871 335 Q 893 334 898 344 Q 905 357 887 372 Q 827 418 775 406 Q 678 390 525 369 L 462 362 Q 323 349 166 332 Q 144 331 160 311 Q 175 295 195 289 Q 217 282 236 287 Q 338 312 453 323 L 531 330 Z">
            </path>
            <path
              d="M 525 369 Q 532 400 538 438 Q 542 466 548 479 Q 555 486 550 498 Q 537 511 500 524 C 472 535 441 544 451 516 Q 452 512 456 506 Q 471 443 463 372 Q 462 368 462 362 L 453 323 Q 411 200 348 147 Q 308 110 201 60 Q 173 45 206 45 Q 258 42 357 93 Q 405 117 437 161 Q 482 218 509 309 L 525 369 Z">
            </path>
            <path
              d="M 509 309 Q 588 185 689 52 Q 708 30 742 30 Q 856 29 892 34 Q 902 35 905 41 Q 905 47 890 55 Q 739 127 675 181 Q 606 245 531 330 C 511 352 493 334 509 309 Z">
            </path>
          </g>
        </svg><svg>
          <use href="#char3"></use>
        </svg><svg>
          <use href="#char3"></use>
        </svg><svg>
          <use href="#char3"></use>
        </svg><svg>
          <use href="#char3"></use>
        </svg><svg>
          <use href="#char3"></use>
        </svg><svg></svg><svg></svg><svg></svg><svg></svg><svg></svg></div>
      <div class="flex scale-[0.7] origin-left sample"><svg>
          <use href="#char4"></use>
        </svg>
        <svg>
          <use href="#char4"></use>
        </svg>
        <svg>
          <use href="#char4"></use>
        </svg>
      </div>
      <div class="write-them-down flex w-100 justify-between"><svg>
          <g transform="translate(5, 43.671875) scale(0.04296875, -0.04296875)" id="char4">
            <path
              d="M 299 746 Q 359 655 388 651 Q 404 647 415 669 Q 419 685 409 711 Q 399 733 371 747 Q 328 774 308 779 Q 296 783 294 768 Q 291 758 299 746 Z">
            </path>
            <path
              d="M 180 682 Q 205 622 204 550 Q 205 277 161 146 Q 139 83 178 38 Q 191 22 203 38 Q 242 80 244 243 Q 250 564 267 644 Q 270 665 251 676 Q 226 698 194 708 Q 184 711 176 701 Q 172 694 180 682 Z">
            </path>
            <path
              d="M 519 749 Q 500 750 505 738 Q 512 725 537 712 Q 553 702 618 719 Q 732 755 754 717 Q 761 698 765 648 Q 783 405 769 128 Q 768 88 753 76 Q 738 66 666 85 Q 650 89 650 79 Q 651 72 664 64 Q 728 16 762 -21 Q 784 -42 797 -39 Q 810 -36 822 -6 Q 838 40 837 110 Q 819 498 822 642 Q 822 685 835 709 Q 848 733 836 745 Q 826 761 775 787 Q 754 797 689 779 Q 598 758 519 749 Z">
            </path>
          </g>
        </svg><svg>
          <use href="#char4"></use>
        </svg><svg>
          <use href="#char4"></use>
        </svg><svg>
          <use href="#char4"></use>
        </svg><svg>
          <use href="#char4"></use>
        </svg><svg>
          <use href="#char4"></use>
        </svg><svg></svg><svg></svg><svg></svg><svg></svg><svg></svg></div>
    </div>
  </section>
  <style>
    path {
      /* 仅当 --char-index === --stroke-index 时，可得 1（true），否则 0 （false）*/
      --is-current: clamp(0,
          calc(1 - (var(--char-index) - var(--stroke-index)) * (var(--char-index) - var(--stroke-index))),
          1);
      /* 仅当 --char-index > --stroke-index 时，可得 1（true），否则 0 （false）*/
      --is-past: clamp(0,
          calc(var(--char-index) - var(--stroke-index)),
          1);
      /* 仅当 --char-index < --stroke-index 时，可得 1（true），否则 0 （false）*/
      --is-next: clamp(0,
          calc(var(--stroke-index) - var(--char-index)),
          1);

      /* 设计不同场景下笔画填色
    当前笔画：红色 - current: rgba(187,  68,  68, 1);
    之前笔画：黑色 - past:    rgba( 85,  85,  85, 1);
    后继笔画：透明 - next:    rgba(any, any, any, 0);
    描红笔画：灰色 - gray:    rgba(185, 185, 185, 1);
    */
      --stroke-color: rgba(calc(85 * var(--is-past) + 187 * var(--is-current) + 68 * var(--is-gray)),
          calc(85 * var(--is-past) + 68 * var(--is-current) + 68 * var(--is-gray)),
          calc(85 * var(--is-past) + 68 * var(--is-current) + 68 * var(--is-gray)),
          calc(1 - var(--is-next)));

      fill: var(--stroke-color);
    }

    :root {
      --is-gray: 0;
      /* 初始化为 100，使描红字样必定计算出 --is-past=1，--is-current=0 --is-next=0 */
      --char-index: 100;
    }

    .write-them-down {
      /* 描红格子里填充灰色 */
      --is-gray: 1;
    }

    #char>div>svg {
      display: inline-block;
      /* https://bloggerpilot.com/en/tools/svg-to-css/ */
      background-image: url("data:image/svg+xml,%3Csvg width='59' height='59' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0l59 59M0 59L59 0M0 30h59M30 0v59' stroke-dasharray='4 4' stroke='%23aaa' fill='none' /%3E%3C/svg%3E");
      background-size: contain;
      border: 1px solid #aaa;
      width: 54px;
      height: 54px;
    }

    #math {
      font-family: 'Courier New', Courier, monospace;
      font-size: 24px;
      color: #666;
    }

    #math .question {
      text-align: center;
    }

    #math .question:first-child {
      text-align: left;
    }

    #math .question:last-child {
      text-align: right;
    }

    #math .question>span {
      display: inline-block;
      vertical-align: middle;
      text-align: center;
      width: 36px;
      height: 36px;
    }

    #math .box {
      border: 1px solid #aaa;
      border-radius: 2px;
    }

    .sample>svg+svg {
      margin-left: 4px;
    }

    .write-them-down+.sample {
      margin-top: 8px;
    }

    .write-them-down:not(:last-child) {
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
    }
  </style>
  <script>
    const injectedStyles = Array.from({ length: 100 })
      .map((_, idx) => `
      .sample > svg:nth-child(${idx + 1}) { --char-index: ${idx + 1}; }
      path:nth-child(${idx + 1}) { --stroke-index: ${idx + 1}; }
      `
      ).join('\n')

    document.querySelector('#injected')?.remove()
    document.head.insertAdjacentHTML('beforeend', `<style id="injected">${injectedStyles}</style>`) 
  </script>
</body>

</html>