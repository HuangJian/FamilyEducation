<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="Cache-Control" content="no-transform " />
  <title>做题家 - 启蒙</title>
  <link rel="shortcut icon" type="image/ico" href="../assets/favicon.ico"/>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>

  <section class="error hidden relative py-3 pl-4 pr-10 leading-normal text-red-700 bg-red-100 rounded-lg" role="alert">
    <p id="message"></p>
    <span class="absolute inset-y-0 right-0 flex items-center mr-4" onclick="closeErrorMessage()" role="button">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </span>
  </section>

  <form class="space-y-4 text-gray-700 container mx-auto">
    <div class="flex flex-wrap">
      <div class="w-full">
        <label class="block mb-1" for="char-to-practise">汉字：</label>
        <input class="w-full h-10 px-3 text-base placeholder-gray-600 border rounded-lg focus:shadow-outline" 
               type="text" id="char-to-practise" value="人大小多少"/>
      </div>
      <div class="w-full" id="strokes"></div>
    </div>
    <div class="flex flex-wrap">
      <div class="w-full">
        <label class="block mb-1" for="calculations">算式：</label>
        <textarea id="calculations" rows="8"
                  class="w-full h-52 px-3 py-2 text-base text-gray-700 placeholder-gray-600 
                         border rounded-lg focus:shadow-outline"></textarea>
      </div>
    </div>

    <div>
      <button class="h-10 px-5 m-2 text-green-100 transition-colors duration-150 bg-green-700 rounded-lg 
                    focus:shadow-outline hover:bg-green-800"
              onclick="make()" type="button">制作习题</button>
      <button class="h-10 px-5 text-indigo-700 transition-colors duration-150 border border-indigo-500 rounded-lg 
                    focus:shadow-outline hover:bg-indigo-500 hover:text-indigo-100" 
              onclick="copyHtmlSource()" type="button">copy html source</button>
      <button class="h-10 px-5 text-indigo-700 transition-colors duration-150 border border-indigo-500 rounded-lg 
                    focus:shadow-outline hover:bg-indigo-500 hover:text-indigo-100" 
              onclick="showStrokeNames()" type="button">显示笔顺</button>
    </div>
  </form>

  <hr>
  <section id="output">
    <div id="math" class="flex flex-col max-w-2xl mx-auto"></div>
    <hr class="my-2">
    <div id="char" class="flex flex-col max-w-2xl mx-auto"></div>
  </section>
</body>

<script src="https://cdn.jsdelivr.net/npm/cnchar/cnchar.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/cnchar-draw/cnchar.draw.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/cnchar-order/cnchar.order.min.js" crossorigin="anonymous"></script>
<script src="./index.js"></script>

<style id="globalStyle">
  path {
    /* 仅当 --char-index === --stroke-index 时，可得 1（true），否则 0 （false）*/
    --is-current: clamp(
      0,         
      calc(1 - (var(--char-index) - var(--stroke-index)) * (var(--char-index) - var(--stroke-index))),
      1);
    /* 仅当 --char-index > --stroke-index 时，可得 1（true），否则 0 （false）*/
    --is-past: clamp(
      0, 
      calc(var(--char-index) - var(--stroke-index)),
      1);
    /* 仅当 --char-index < --stroke-index 时，可得 1（true），否则 0 （false）*/
    --is-next: clamp(
      0, 
      calc(var(--stroke-index) - var(--char-index)),
      1);

    /* 设计不同场景下笔画填色
    当前笔画：红色 - current: rgba(187,  68,  68, 1);
    之前笔画：黑色 - past:    rgba( 85,  85,  85, 1);
    后继笔画：透明 - next:    rgba(any, any, any, 0);
    描红笔画：灰色 - gray:    rgba(185, 185, 185, 1);
    */
    --stroke-color: rgba(
      calc(85 * var(--is-past) + 187 * var(--is-current) + 68 * var(--is-gray)),
      calc(85 * var(--is-past) + 68  * var(--is-current) + 68 * var(--is-gray)),
      calc(85 * var(--is-past) + 68  * var(--is-current) + 68 * var(--is-gray)),
      calc(1  - var(--is-next))
    );

    fill: var(--stroke-color);
  }
  :root {
    --is-gray: 0; 
    /* 初始化为 100，使描红字样必定计算出 --is-past=1，--is-current=0 --is-next=0 */
    --char-index: 100;
  }

  .write-them-down {
    /* 描红格子里填充灰色 */
    --is-gray: 1;
  }

  #char > div > svg {
      display: inline-block;
      /* https://bloggerpilot.com/en/tools/svg-to-css/ */
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0l60 60M0 60L60 0M0 30h60M30 0v60' stroke-dasharray='4 4' stroke='rgba(70, 160, 80, 0.5)' fill='none' /%3E%3C/svg%3E");
      background-size: contain;
      border: 1px solid rgba(70, 160, 80, 0.5);
      width: 54px;
      height: 54px;
  }

  #math {
      font-family: 'Courier New', Courier, monospace;
      font-size: 24px;
      color: #666;
  }

  #math .question {
      text-align: center;
  }
  #math .question:first-child {
      text-align: left;
  }
  #math .question:last-child {
      text-align: right;
  }

  #math .question > span {
      display: inline-block;
      vertical-align: middle;
      text-align: center;
      width: 36px;
      height: 36px;
  }

  #math .box {
      border: 1px solid #aaa;
      border-radius: 2px;
  }

  .sample > svg + svg {
      margin-left: 4px;
  }

  .write-them-down + .sample {
      margin-top: 8px;
  }
  .write-them-down:not(:last-child) {
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
  }
</style>
</html>